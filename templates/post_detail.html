{% extends "base.html" %}

{% block content %}
<!-- Sekcja posta -->
<article class="mb-5 p-4 border rounded shadow-sm mx-auto" style="max-width: 800px; background-color: #ffffff;">
    <!-- Przycisk powrotu do strony g≈Ç√≥wnej -->
    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">‚Üê Powr√≥t</a>
    <h2 class="text-center">{{ post.title }}</h2>

    <!-- Tytu≈Ç posta -->
    <p>{{ post.content }}</p>

    <!-- Wy≈õwietlanie jednego lub dw√≥ch zdjƒôƒá je≈õli istniejƒÖ -->
    {% if post.image or post.image2 %}
    <div class="d-flex justify-content-center gap-3 my-3">
        {% if post.image %}
            <img src="{{ post.image }}" alt="Zdjƒôcie" class="img-fluid rounded shadow-sm" style="max-width: 100px; height: auto;">
        {% endif %}
        {% if post.image2 %}
            <img src="{{ post.image2 }}" alt="Zdjƒôcie 2" class="img-fluid rounded shadow-sm" style="max-width: 100px; height: auto;">
        {% endif %}
    </div>
{% endif %}


</article>
<!-- Sekcja komentarzy -->
<section class="mb-5 mx-auto" style="max-width: 800px;">
    <h4 class="mb-3">üí¨ Komentarze</h4>
    <div id="comments-list">
    {% for comment in post.comments %}
        <div class="border rounded p-3 mb-3 bg-white shadow-sm position-relative">
    <div style="max-width: 90%; word-wrap: break-word;">
        {{ comment.content }}
    </div>

    <!-- Dropdown z akcjami (edytuj, usu≈Ñ) -->
    <div class="dropdown position-absolute top-0 end-0 m-2">
        <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            ‚ãØ
        </button>
        <ul class="dropdown-menu">
            <li>
                <a class="dropdown-item" href="{{ url_for('edit_comment', comment_id=comment.id) }}">Edytuj</a>
            </li>
            <li>
                <form action="{{ url_for('delete_comment', comment_id=comment.id) }}" method="POST" style="margin: 0;">
                    <button type="submit" class="dropdown-item text-danger" onclick="return confirm('Na pewno usunƒÖƒá komentarz?')">
                        Usu≈Ñ
                    </button>
                </form>
            </li>
        </ul>
    </div>
</div>
    {% else %}
        <p class="text-muted">Brak komentarzy.</p>
    {% endfor %}
</div>
</section>
<!-- Formularz dodawania komentarza -->
<section class="mb-5 mx-auto" style="max-width: 800px;">
    <h5 class="mb-3">Dodaj komentarz</h5>
    <form method="POST" id="comment-form">
        {{ form.hidden_tag() }}
        <div class="mb-3">
            {{ form.content.label(class="form-label") }}
            {{ form.content(class="form-control", rows="4") }}
        </div>
         <button type="submit" class="btn btn-primary">Dodaj komentarz</button>
    </form>
</section>
<!-- JavaScript obs≈ÇugujƒÖcy AJAX dodawania komentarza -->
<script>
document.getElementById('comment-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const content = document.querySelector('#comment-form textarea').value; // Pobierz tre≈õƒá komentarza
    const postId = "{{ post.id }}";

    fetch(`/api/comments/${postId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json' // Informujemy, ≈ºe dane to JSON
        },
        body: JSON.stringify({ content: content }) // Wysy≈Çamy tre≈õƒá komentarza
    })
    .then(response => response.json())
    .then(data => {
        // Po dodaniu komentarza dynamicznie dodaj go na g√≥rƒô listy
        const newComment = document.createElement('div');
        newComment.className = "border rounded p-3 mb-3 bg-white shadow-sm";
        newComment.textContent = data.content;
        // Dodanie nowego komentarza przed istniejƒÖcymi
        document.getElementById('comments-list').prepend(newComment);
        // Wyczy≈õƒá pole tekstowe
        document.querySelector('#comment-form textarea').value = "";
    });
});
</script>

{% endblock %}
